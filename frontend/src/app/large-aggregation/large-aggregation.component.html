<ng-template #resultTemplate let-bucket="result" let-t="term">
  <ng-container *ngIf="bucket !== 'REFINE'; else refine">
    <ngb-highlight [result]="bucket.key" [term]="t"></ngb-highlight>
    <small class="ml-1 text-muted">[{{ bucket.documentCount | number }}]</small>
  </ng-container>
  <ng-template #refine>
    <div class="text-muted small">D'autres r√©sultats existent.<br/>Affinez votre recherche.</div>
  </ng-template>
</ng-template>

<div class="card mb-1" *ngIf="aggregation.buckets.length">
  <div class="card-body">

    <!-- title -->
    <!-- tooltip precising what is the number displayed -->
    <ng-template #tooltipContent>
      <ng-container [ngPlural]="aggregation.buckets.length">
        <ng-template ngPluralCase="=1">Un seule valeur possible pour <i>{{ aggregation.name | aggregationName }}</i></ng-template>
        <ng-template ngPluralCase="other">{{ aggregation.buckets.length | number }} valeurs possibles pour <i>{{ aggregation.name | aggregationName }}</i></ng-template>
      </ng-container>
    </ng-template>
    <h3 class="card-title">{{ aggregation.name | aggregationName }}
      <small class="text-muted ml-1" [ngbTooltip]="tooltipContent" placement="top" container="body">({{ aggregation.buckets.length | number }})</small>
    </h3>

    <!-- values as pills and a typeahead to add them -->
    <div class="mb-2">
      <span class="badge badge-pill badge-secondary mr-1" *ngFor="let key of selectedKeys" tabindex="0"
            (keydown.backspace)="removeKey(key)">
        <rare-document-count [name]="key" [count]="documentCountForKey(key)" [muted]="false"></rare-document-count>
        <button tabindex="-1" type="button" class="btn btn-link" (click)="removeKey(key)">&times;</button>
      </span>
    </div>
    <input #typeahead class="form-control" [formControl]="criterion" [ngbTypeahead]="search"
           (selectItem)="selectKey($event)" [resultTemplate]="resultTemplate" container="body"/>
  </div>
</div>



